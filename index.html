<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="stylesheet" type="text/css" id="theme-link">
    <title>Another Redis Desktop Manager</title>
  </head>
  <body>
    <!-- this script must be placed here after body -->
    <script type="text/javascript">
      const ipcRenderer = require('electron').ipcRenderer;

      function changeCSS(theme = 'light') {
        const themeHref = `static/theme/${theme}/index.css`;
        document.getElementById('theme-link').href = themeHref;
        theme == 'dark' ? document.body.classList.add('dark-mode') :
                          document.body.classList.remove('dark-mode');
      }

      function globalChangeTheme(theme) {
        if (!theme) {
          theme = localStorage.theme;
          !['system', 'light', 'dark'].includes(theme) && (theme = 'system');
        }

        // ipcRenderer.invoke('changeTheme', theme).then(shouldUseDarkColors => {
        //   changeCSS(shouldUseDarkColors ? 'dark' : 'light')
        // });
        // return;

        // system
        if (theme == 'system') {
          ipcRenderer.invoke('changeTheme', theme).then(shouldUseDarkColors => {
            changeCSS(shouldUseDarkColors ? 'dark' : 'light')
          });
        }
        // light/dark change directly to reduce delay
        else {
          changeCSS(theme);
          ipcRenderer.invoke('changeTheme', theme);
        }
      }

      // triggered by OS theme changed
      ipcRenderer.on('os-theme-updated', (event, arg) => {
        // auto change only when theme set to 'system'
        if (arg.themeSource != 'system') {
          return;
        }

        changeCSS(arg.shouldUseDarkColors ? 'dark' : 'light');
      })

      // theme init at startup
      globalChangeTheme();
    </script>

    <div id="app"></div>
    <!-- built files will be auto injected -->
  </body>
</html>
